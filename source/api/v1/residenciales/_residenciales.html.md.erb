# Servicios Residenciales

Colección de métodos para el aprovisionamiento de Servicios Residenciales


## <span style="background-color:Orange; color:white; border-radius: 4px; font-size: 16px; text-align: center;">POST</span> - Alta HSI

> **Ejemplo**

```shell
curl --location --request POST 'http://10.64.17.44:32792/restconf/data/services/pon/services?no-out-of-sync-check&wait-device=CEYD-01Z' \
--header 'Content-Type: application/yang-data+json' \
--header 'Accept: application/yang-data+json' \
--header 'Authorization: Basic YWRtaW46YWRtaW4=' \
--data-raw '{
    "antel-pon-hsi:hsi": {
        "code": "JL6101",
        "customer": "PEREIRA ASIS",
        "onus": {
            "olt": "CEYD-01Z",
            "rack": "1",
            "shelf": "1",
            "slot": "3",
            "port": "1",
            "onuid": "30",
            "service-type": "router",
            "traffic-profile": {
                "downstream": "DOWN100MBPS",
                "upstream": "UPFXS"
            }
        }
    }
}'
```

```python
import requests

url = "http://10.64.17.44:32792/restconf/data/services/pon/services?no-out-of-sync-check&wait-device=CEYD-01Z"

payload="{\r\n    \"antel-pon-hsi:hsi\": {\r\n        \"code\": \"JL6101\",\r\n        \"customer\": \"PEREIRA ASIS\",\r\n        \"onus\": {\r\n            \"olt\": \"CEYD-01Z\",\r\n            \"rack\": \"1\",\r\n            \"shelf\": \"1\",\r\n            \"slot\": \"3\",\r\n            \"port\": \"1\",\r\n            \"onuid\": \"30\",\r\n            \"service-type\": \"router\",\r\n            \"traffic-profile\": {\r\n                \"downstream\": \"DOWN100MBPS\",\r\n                \"upstream\": \"UPFXS\"\r\n            }\r\n        }\r\n    }\r\n}"
headers = {
  'Content-Type': 'application/yang-data+json',
  'Accept': 'application/yang-data+json',
  'Authorization': 'Basic YWRtaW46YWRtaW4='
}

response = requests.request("POST", url, headers=headers, data=payload)

print(response.text)
```

> **Posibles salidas**

> Alta creada correctamente - 201 Created

```json
{
  "commit-queue": {
    "id": "1614016683699",
    "status": "completed"
  }
}
```


> Error por ONU con servicio HSI ya configurado - 400 Bad Request

```json
{
  "errors": {
    "error": [
      {
        "error-message": "Python cb_create error. La ONU ya tiene un servicio HSI configurado",
        "error-path": "/tailf-ncs:services/antel-pon:pon/services/antel-pon-hsi:hsi=JL6101",
        "error-tag": "malformed-message",
        "error-type": "application"
      }
    ]
  }
}
```

Crea un servicio HSI identificado por su código. 
Cada servicio HSI puede configurarse en más de una ONU con características distintas (tipo, velocidades, etc). 

### **HTTP Request**

`/data/services/pon/services?no-out-of-sync-check&wait-device=<olt>`

### **Parámetros**
| Key                    | Value            |
|------------------------|------------------|
| `no-out-of-sync-check` |                  |
| `wait-device`          | Nombre de la OLT |

### **Encabezados**

`Content-Type: application/yang-data+json`  
`Accept: application/yang-data+json`  

### **Atributos**

| Atributo          | Mandatorio | Tipo                          | Descripción                                                                                                                     |
|-------------------|------------|-------------------------------|---------------------------------------------------------------------------------------------------------------------------------|
| `code`            | Si         | String                        | Código que identifica al servicio HSI.                                                                                          |
| `customer`        | No         | String                        | Apellidos del cliente separados por espacio.                                                                                    |
| `onus`            |            | Lista                         | Lista de onus donde se va a configurar el/los servicios(puede ser más de una). Contiene los elementos descriptos a continuación |
| `olt`             | Si         | String                        | Nombre de la OLT. Restringido a las OLTs desplegadas.                                                                           |
| `rack`            | Si         | Int                           | Número de rack.                                                                                                                 |
| `shelf`           | Si         | Int                           | Número de shelf.                                                                                                                |
| `slot`            | Si         | Int                           | Número de slot.                                                                                                                 |
| `port`            | Si         | Int                           | Número de puerto                                                                                                                |
| `onuid`           | Si         | Int                           | ID de la ONU.                                                                                                                   |
| `service-type`    | Si         | Enum: "bridge"       "router" | Tipo de servicio HSI.                                                                                                           |
| `wifi-mesh`       | No         | Boolean Default false         | Indica si el servicio tiene wifi-mesh. Solo es posible configurarlo en "true" cuando el service-type es "router"                |
| `traffic-profile` |            | Contenedor                    | Perfiles de velocidad del servicio                                                                                              |
| `downstream`      | Si         | String                        | Perfil de velocidad de bajada. Restringido a los perfiles conocidos.                                                            |
| `upstream`        | Si         | String                        | Perfil de velocidad de subida. Restringido a los perfiles conocidos.                                                            |

## <span style="background-color:Gray; color: white; border-radius: 4px; font-size: 16px; text-align: center;">PATCH</span> - Modificar HSI

> **Ejemplo - cambio de perfiles de velocidad**

```shell
curl --location --request PATCH 'http://10.64.17.44:32729/restconf/data/services/pon/services/hsi?no-out-of-sync-check&wait-device=CEYD-01Z' \
--header 'Content-Type: application/yang-data+json' \
--header 'Accept: application/yang-data+json' \
--header 'Authorization: Basic cm9vdDpBbnRlbDFMb2dpY2FsaXMh' \
--data-raw '{
    "antel-pon-hsi:hsi": {
        "code": "JL6101",
        "onus": {
            "olt": "CEYD-01Z",
            "rack": "1",
            "shelf": "1",
            "slot": "3",
            "port": "1",
            "onuid": "30",
            "traffic-profile": {
                "downstream": "DOWN100MBPS",
                "upstream": "UP5MBPS"
            }
        }
    }
}'
```

```python
import requests

url = "http://10.64.17.44:32729/restconf/data/services/pon/services/hsi?no-out-of-sync-check&wait-device=CEYD-01Z"

payload="{\r\n    \"antel-pon-hsi:hsi\": {\r\n        \"code\": \"JL6101\",\r\n        \"onus\": {\r\n            \"olt\": \"CEYD-01Z\",\r\n            \"rack\": \"1\",\r\n            \"shelf\": \"1\",\r\n            \"slot\": \"3\",\r\n            \"port\": \"1\",\r\n            \"onuid\": \"30\",\r\n            \"traffic-profile\": {\r\n                \"downstream\": \"DOWN100MBPS\",\r\n                \"upstream\": \"UP5MBPS\"\r\n            }\r\n        }\r\n    }\r\n}"
headers = {
  'Content-Type': 'application/yang-data+json',
  'Accept': 'application/yang-data+json',
  'Authorization': 'Basic cm9vdDpBbnRlbDFMb2dpY2FsaXMh'
}

response = requests.request("PATCH", url, headers=headers, data=payload)

print(response.text)
```


> **Ejemplo - cambio de tipo de servicio**

```shell
curl --location --request PATCH 'http://10.64.17.44:32729/restconf/data/services/pon/services/hsi?no-out-of-sync-check&wait-device=CEYD-01Z' \
--header 'Content-Type: application/yang-data+json' \
--header 'Accept: application/yang-data+json' \
--header 'Authorization: Basic cm9vdDpBbnRlbDFMb2dpY2FsaXMh' \
--data-raw '{
    "antel-pon-hsi:hsi": {
        "code": "JL6101",
        "onus": {
            "olt": "CEYD-01Z",
            "rack": "1",
            "shelf": "1",
            "slot": "3",
            "port": "1",
            "onuid": "30",
            "service-type": "bridge"
        }
    }
}'
```

```python
import requests

url = "http://10.64.17.44:32729/restconf/data/services/pon/services/hsi?no-out-of-sync-check&wait-device=CEYD-01Z"

payload="{\r\n    \"antel-pon-hsi:hsi\": {\r\n        \"code\": \"JL6101\",\r\n        \"onus\": {\r\n            \"olt\": \"CEYD-01Z\",\r\n            \"rack\": \"1\",\r\n            \"shelf\": \"1\",\r\n            \"slot\": \"3\",\r\n            \"port\": \"1\",\r\n            \"onuid\": \"30\",\r\n            \"service-type\": \"bridge\"\r\n        }\r\n    }\r\n}"
headers = {
  'Content-Type': 'application/yang-data+json',
  'Accept': 'application/yang-data+json',
  'Authorization': 'Basic cm9vdDpBbnRlbDFMb2dpY2FsaXMh'
}

response = requests.request("PATCH", url, headers=headers, data=payload)

print(response.text)
```

Modifica alguno de los parámetros de un servicio HSI existente. 
El código de identificación no puede ser cambiado con éste método (Ver Cambiar-código-HSI). 
También puede agregar una configuración nueva en caso de agregar una nueva ONU a la lista del servicio.

### **HTTP Request**

`/data/services/pon/services/hsi?no-out-of-sync-check&wait-device=<olt>`

### **Parámetros**
| Key                    | Value            |
|------------------------|------------------|
| `no-out-of-sync-check` |                  |
| `wait-device`          | Nombre de la OLT |

### **Encabezados**

`Content-Type: application/yang-data+json`  
`Accept: application/yang-data+json`  

### **Atributos**

Mismos atributos que para el alta HSI. No es nesesario enviar todos, solo los identificadores de servicio y ONU 
y los parámetros que se requiera modificar.


## <span style="background-color:Orange; color: white; border-radius: 4px; font-size: 16px; text-align: center;">POST</span> - Cambiar código HSI

> **Ejemplo**

> Request

```shell
curl --location --request POST 'http://10.64.17.44:32729/restconf/data/services/pon/actions/change-service-code' \
--header 'Content-Type: application/yang-data+json' \
--header 'Accept: application/yang-data+json' \
--data-raw '{
    "input": {
        "service-type": "hsi",
        "old-code": "JL6101",
        "new-code": "KR5202",
        "new-customer": "PEREZ GONZALEZ"
    }
}'
```

```python
import requests

url = "http://10.64.17.44:32729/restconf/data/services/pon/actions/change-service-code"

payload="{\r\n    \"input\": {\r\n        \"service-type\": \"hsi\",\r\n        \"old-code\": \"JL6101\",\r\n        \"new-code\": \"KR5202\",\r\n        \"new-customer\": \"PEREZ GONZALEZ\"\r\n    }\r\n}"
headers = {
  'Content-Type': 'application/yang-data+json',
  'Accept': 'application/yang-data+json'
}

response = requests.request("POST", url, headers=headers, data=payload)

print(response.text)
```

> **Posibles respuestas**

> Operación Correcta

```json
{
    "antel-pon-change-service-code:output": {
        "message": "Operacion correcta"
    }
}
```

>  Mal el tipo de servicio

```json
{
    "antel-pon-change-service-code:output": {
        "message": "El tipo de servicio no es correcto"
    }
}
```

>  Código de servicio no existente

```json
{
    "antel-pon-change-service-code:output": {
        "message": "El servicio JL6101 no existe"
    }
}
```

>  Nuevo código de servicio ya existente

```json
{
    "antel-pon-change-service-code:output": {
        "message": "El servicio KR5202 ya existe"
    }
}
```

Acción que permite modifica el códico de indentificación de un servicio 
(borra el servicio viejo y lo vuelve a crear con los mismos parámetros pero con un nuevo código identificador).

### **HTTP Request**

`/data/services/pon/actions/change-service-code`

### **Parámetros**
Vacío

### **Encabezados**

`Content-Type: application/yang-data+json`  
`Accept: application/yang-data+json`  

### **Atributos**

| Atributo       | Mandatorio | Tipo                          | Descripción                                                   |
|----------------|------------|-------------------------------|---------------------------------------------------------------|
| `service-type` | Si         | Enum: "hsi"/"voip"/"business" | Tipo de servicio al cual cambiar el código. En este caso hsi. |
| `old-code`     | Si         | string                        | Código que identifica el servicio HSI al cual modificar.      |
| `new-code`     | Si         | string                        | Nuevo código de identificación del servicio.                  |
| `new-customer` | No         | string                        | atributo adicional para modificar también el customer.        |

### **Respuesta**
Parámetro "message" con las siguientes opciones de mensaje:

| Mensaje                              | Descripción                                                                                |
|--------------------------------------|--------------------------------------------------------------------------------------------|
| `Operación Correcta`                 | La operación de cambio de código fue ejecutada correctamente.                              |
| `El tipo de servicio no es correcto` | Cuando se intentó modificar un tipo de servicio que no es el correcto.                     |
| `El servicio <old-code> no existe`   | Cuando el identificador de servicio ingresado no existe.                                   |
| `El servicio <new-code> ya existe`   | Cuando el nuevo identificador de servicio ingresado entra en conflicto con otro existente. |


## <span style="background-color:Orange; color: white; border-radius: 4px; font-size: 16px; text-align: center;">POST</span> - Chequeo de sincronismo HSI

> **Ejemplo**

```shell
curl --location --request POST 'http://10.64.17.44:32772/restconf/data/services/pon/services/hsi=JL6101/check-sync' \
--header 'Accept: application/yang-data+json' \
--header 'Authorization: Basic YWRtaW46YWRtaW4='
```

```python
import requests

url = "http://10.64.17.44:32772/restconf/data/services/pon/services/hsi=JL6101/check-sync"

payload={}
headers = {
  'Accept': 'application/yang-data+json',
  'Authorization': 'Basic YWRtaW46YWRtaW4='
}

response = requests.request("POST", url, headers=headers, data=payload)

print(response.text)

```

> **Respuesta**

```json
{
    "antel-pon-hsi:output": {
        "in-sync": true
    }
}
```

Acción que verifica si el servicio HSI está en sincronismo, 
es decir si la OLT tiene configurado lo que el Master (NSO) tiene guardado en su DB como configuración actual.

### **HTTP Request**

`data/services/pon/services/hsi=<hsi_code>/check-sync`

### **Parámetros**
| Key        | Value                                                 |
|------------|-------------------------------------------------------|
| `hsi`      | Código de identificación del servicio HSI a verificar |

### **Encabezados**

`Accept: application/yang-data+json`  

### **Atributos**
Vacío

### **Respuesta**
Parámetro booleano "in-sync" que vale True cuando el servicio está en sincronismo y False cuando no.


## <span style="background-color:Green; color: white; border-radius: 4px; font-size: 16px; text-align: center;">GET</span> - Ver HSI

> **Ejemplo**

```shell
curl --location --request GET 'http://10.64.17.44:32772/restconf/data/services/pon/services/hsi=JL6101?content=config' \
--header 'Accept: application/yang-data+json' \
--header 'Authorization: Basic YWRtaW46YWRtaW4='
```

```python
import requests

url = "http://10.64.17.44:32772/restconf/data/services/pon/services/hsi=JL6101?content=config"

payload={}
headers = {
  'Accept': 'application/yang-data+json',
  'Authorization': 'Basic YWRtaW46YWRtaW4='
}

response = requests.request("GET", url, headers=headers, data=payload)

print(response.text)

```

> **Respuesta**

```json
{
    "antel-pon-hsi:hsi": {
        "code": "JL6101",
        "customer": "PEREIRA ASIS",
        "onus": [
            {
                "olt": "CEYD-01Z",
                "rack": 1,
                "shelf": 1,
                "slot": 3,
                "port": 1,
                "onuid": 30,
                "service-type": "router",
                "traffic-profile": {
                    "downstream": "DOWN120MBPS",
                    "upstream": "UPFXS"
                }
            }
        ]
    }
}
```

Acción que muestra los parámetros de un servicio HSI específico.

### **HTTP Request**

`data/services/pon/services/hsi=<hsi_code>/content=config`

### **Parámetros**
| Key        | Value                                                 |
|------------|-------------------------------------------------------|
| `hsi`      | Código de identificación del servicio HSI a verificar |
| `content`  | "config"                                              |

### **Encabezados**
`Accept: application/yang-data+json`   

### **Atributos**
Vacío

### **Respuesta**
JSON/XML que contiene la informacion del servicio HSI. 
Los campos del JSON son los mismos que los requeridos para el alta HSI.


## <span style="background-color:#d22d2d; color: white; border-radius: 4px; font-size: 16px; text-align: center;">DELETE</span> - Baja HSI

> **Ejemplo**

```shell
curl --location --request DELETE 'http://10.64.17.44:32772/restconf/data/services/pon/services/hsi=JL6101?no-out-of-sync-check&wait-device=CEYD-01Z' \
--header 'Accept: application/yang-data+json' \
--header 'Authorization: Basic YWRtaW46YWRtaW4=' \
--data-raw ''
```

```python
import requests

url = "http://10.64.17.44:32772/restconf/data/services/pon/services/hsi=JL6101?no-out-of-sync-check&wait-device=CEYD-01Z"

payload={}
headers = {
  'Accept': 'application/yang-data+json',
  'Authorization': 'Basic YWRtaW46YWRtaW4='
}

response = requests.request("DELETE", url, headers=headers, data=payload)

print(response.text)

```


Da la baja del servicio HSI especificado.

### **HTTP Request**

`data/services/pon/services/hsi=<hsi_code>?no-out-of-sync-check&wait-device=<olt>`

### **Parámetros**
| Key           | Value                                                 |
|---------------|-------------------------------------------------------|
| `hsi`         | Código de identificación del servicio HSI a verificar |
| `wait-device` | Nombre de la OLT                                      |

### **Encabezados**
`Accept: application/yang-data+json`   

### **Atributos**
Vacío
